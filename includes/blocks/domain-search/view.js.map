{"version":3,"file":"domain-search/view.js","mappings":"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","sources":["webpack://domain-search/./src/domain-search/view.js"],"sourcesContent":["/**\n * Front-end JavaScript for the Domain Search Block.\n *\n * Handles user input, makes API requests via the WordPress REST API,\n * and displays results.\n */\n\n// Function to run for each domain search block instance on the page\nfunction initializeDomainSearchBlock(blockElement) {\n\t// Find the necessary elements within this specific block instance\n\tconst input = blockElement.querySelector('.domain-search-input');\n\tconst button = blockElement.querySelector('.domain-search-button');\n\tconst resultsContainer = blockElement.querySelector('.domain-search-results');\n\n\t// Exit if essential elements aren't found (safety check)\n\tif (!input || !button || !resultsContainer) {\n\t\tconsole.error('Domain Search Block: Missing required elements inside:', blockElement);\n\t\treturn;\n\t}\n\n\tconst sldRegex = /^[a-z0-9-]+$/; // Allowed characters for SLD\n\t// Regex for invalid hyphen use: starts/ends with -, or '--' unless preceded by 'xn--' (basic IDN check)\n\tconst invalidHyphenRegex = /(^-|-$|^.{0,1}-(?!--)|(?<!xn)-{2,})/;\n\n\tfunction validateDomainInput() {\n\t\tconst domainValue = input.value.trim().toLowerCase();\n\t\tlet isValid = true;\n\t\tlet errorMessage = '';\n\n\t\t// Clear previous visual error state from input field\n\t\tinput.classList.remove('domain-input-error');\n\n\t\t// Find or create an element to display feedback message\n\t\tlet feedbackElement = blockElement.querySelector('.domain-input-feedback');\n\t\tif (!feedbackElement) {\n\t\t\tfeedbackElement = document.createElement('p');\n\t\t\tfeedbackElement.className = 'domain-input-feedback domain-feedback-message'; // Add general class\n\t\t\t// Insert after the input's wrapper if possible, or before results as fallback\n\t\t\tconst wrapper = input.closest('.domain-search-wrapper') || input.parentNode;\n\t\t\tif (wrapper && wrapper.parentNode) {\n\t\t\t\twrapper.parentNode.insertBefore(feedbackElement, wrapper.nextSibling);\n\t\t\t} else {\n\t\t\t\tresultsContainer.parentNode.insertBefore(feedbackElement, resultsContainer);\n\t\t\t}\n\t\t}\n\t\tfeedbackElement.textContent = ''; // Clear previous message\n\t\tfeedbackElement.className = 'domain-input-feedback domain-feedback-message'; // Reset class\n\n\t\t// Only validate non-empty input\n\t\tif (domainValue) {\n\t\t\t// Split input for basic SLD/TLD separation during validation\n\t\t\tconst parts = domainValue.split('.');\n\t\t\tconst potentialSld = parts.length > 1 ? parts.slice(0, -1).join('.') : domainValue;\n\t\t\tconst potentialTld = parts.length > 1 ? parts.pop() : '';\n\n\t\t\t// --- Apply eNom SLD Rules ---\n\t\t\tif (!sldRegex.test(potentialSld)) {\n\t\t\t\tisValid = false;\n\t\t\t\terrorMessage = 'Invalid characters (use only a-z, 0-9, -).';\n\t\t\t} else if (invalidHyphenRegex.test(potentialSld)) {\n\t\t\t\tisValid = false;\n\t\t\t\terrorMessage = 'Cannot start/end with hyphen or use invalid \"--\".';\n\t\t\t} else if (potentialSld.length < 2 || potentialSld.length > 63) {\n\t\t\t\tisValid = false;\n\t\t\t\terrorMessage = `Domain name part must be 2-63 characters (currently ${potentialSld.length}).`;\n\t\t\t}\n\t\t\t// --- Optional: Basic TLD check ---\n\t\t\t// else if (potentialTld && potentialTld.length < 2) {\n\t\t\t//    isValid = false;\n\t\t\t//    errorMessage = 'TLD part seems too short.';\n\t\t\t// }\n\n\t\t\t// Apply visual feedback if invalid\n\t\t\tif (!isValid) {\n\t\t\t\tinput.classList.add('domain-input-error'); // Add error class to input\n\t\t\t\tfeedbackElement.textContent = errorMessage; // Show error message\n\t\t\t\tfeedbackElement.classList.add('domain-feedback-error'); // Style as error\n\t\t\t} else {\n\t\t\t\t// Optional: Show valid state? Or just clear error.\n\t\t\t\t// feedbackElement.textContent = 'Format OK';\n\t\t\t\t// feedbackElement.classList.add('domain-feedback-ok');\n\t\t\t}\n\t\t} // End if (domainValue)\n\t} // End validateDomainInput function\n\n\t// --- Add event listener to trigger validation on input ---\n\tinput.addEventListener('input', validateDomainInput);\n\n\n\t// --- Event Listener for the Search Button ---\n\tbutton.addEventListener('click', async () => {\n\t\tconst domain = input.value.trim().toLowerCase();\n\t\t\n\t\t// --- Basic Validation ---\n\t\t/*\n\t\tif (!domain) {\n\t\t\tresultsContainer.innerHTML = '<p class=\"domain-search-error\">Please enter a domain name.</p>';\n\t\t\tinput.focus(); // Focus back on the input\n\t\t\treturn;\n\t\t}\n\t\t// Very basic domain format check (doesn't validate TLD)\n\t\tif (domain.indexOf('.') === -1 || domain.startsWith('.') || domain.endsWith('.')) {\n\t\t\tresultsContainer.innerHTML = `<p class=\"domain-search-error\">Please enter a valid domain format (e.g., example.com).</p>`;\n\t\t\tinput.focus();\n\t\t\treturn;\n\t\t}\n\t\t*/\n\n\t\tif (input.classList.contains('domain-input-error')) {\n\t\t\tinput.focus(); // Focus on the invalid input\n\t\t\t// Optionally update the main results area too\n\t\t\t// resultsContainer.innerHTML = '<p class=\"domain-search-error\">Please correct the domain format above.</p>';\n\t\t\treturn; // Stop processing if input is currently marked invalid\n\t\t}\n\n\t\t// --- Show Loading State ---\n\n\t\t// Clear validation message when starting a new search\n\t\tlet feedbackElement = blockElement.querySelector('.domain-input-feedback');\n\t\tif (feedbackElement) feedbackElement.textContent = '';\n\n\t\tresultsContainer.innerHTML = '<p class=\"domain-search-loading\">Checking availability...</p>';\n\t\tbutton.disabled = true; // Prevent multiple clicks\n\t\tinput.disabled = true; // Optional: disable input during search\n\n\n\t\t// --- Prepare API Request ---\n\t\tconst formData = new FormData();\n\t\t// 'action' is not typically used/needed for WP REST API calls like this\n\t\t// formData.append('action', 'domain_search_check');\n\t\tformData.append('domain', domain);\n\t\t// Nonce is sent via header, but can be included in body too if needed/preferred by backend logic\n\t\t// formData.append('_wpnonce', domainSearchData.nonce);\n\n\t\ttry {\n\t\t\t// --- Make the Fetch Request ---\n\t\t\tconst response = await fetch(domainSearchData.apiUrl, { // Use the API URL from PHP\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t// Let browser set Content-Type for FormData\n\t\t\t\t\t'X-WP-Nonce': domainSearchData.nonce // Standard header for REST API nonce\n\t\t\t\t},\n\t\t\t\tbody: formData // Send domain\n\t\t\t});\n\n\t\t\t// --- Get response as raw text first ---\n\t\t\tconst responseText = await response.text();\n\n\t\t\t// --- Check if response was ok (status 200-299) ---\n\t\t\tif (!response.ok) {\n\t\t\t\tlet errorMessage = `Error: ${response.status} ${response.statusText}`;\n\t\t\t\t// Try to parse error message from the text, but catch if it's not JSON\n\t\t\t\ttry {\n\t\t\t\t\t// Attempt to parse the text we already retrieved\n\t\t\t\t\tconst errorData = JSON.parse(responseText);\n\t\t\t\t\t// Check specifically for a message property common in WP_Error JSON responses\n\t\t\t\t\tif (errorData.message) {\n\t\t\t\t\t\terrorMessage = errorData.message; // Use the specific message from backend\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Could not parse error response body as JSON:', e);\n\t\t\t\t\t// Optionally include raw text in error if short and not HTML\n\t\t\t\t\tif (responseText && responseText.length < 100 && !responseText.trim().startsWith('<')) {\n\t\t\t\t\t\terrorMessage += ` - Server response: ${responseText}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Throw the error to be caught by the outer catch block\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\n\t\t\t// --- If response.ok, try to parse the text as JSON ---\n\t\t\tlet data;\n\t\t\ttry {\n\t\t\t\t// Attempt to parse the text we already retrieved\n\t\t\t\tdata = JSON.parse(responseText);\n\t\t\t} catch (error) {\n\t\t\t\t// If JSON parsing fails even on a 2xx response, log details and throw generic error\n\t\t\t\tconsole.error(\"JSON Parse Error on successful response:\", error);\n\t\t\t\tthrow new Error('Received an invalid format from the server.');\n\t\t\t}\n\n\t\t\t// --- Display Results (Processing Array) ---\n\t\t\tlet resultsHTML = '';\n\n\t\t\t// Check if data is an array and has items\n\t\t\tif (Array.isArray(data) && data.length > 0) {\n\t\t\t\tresultsHTML = '<ul>'; // Start a list for the results\n\n\t\t\t\tdata.forEach(item => {\n\t\t\t\t\t// Ensure item is an object before accessing properties\n\t\t\t\t\tif (item && typeof item === 'object') {\n\t\t\t\t\t\tresultsHTML += '<li>';\n\t\t\t\t\t\t// Display domain name (escape it)\n\t\t\t\t\t\tresultsHTML += `<strong>${escapeHTML(item.domain || '')}</strong>: `;\n\n\t\t\t\t\t\t// Display status based on item.available\n\t\t\t\t\t\tif (item.available === true) {\n\t\t\t\t\t\t\tresultsHTML += '<span class=\"domain-search-success\">Available</span>';\n\t\t\t\t\t\t\t// Display price if available and valid\n\t\t\t\t\t\t\tif (item.adjusted_price && item.adjusted_price !== 'N/A') {\n\t\t\t\t\t\t\t\t// TODO: Add currency symbol from settings?\n\t\t\t\t\t\t\t\tresultsHTML += ` - $${escapeHTML(item.adjusted_price)}`;\n\t\t\t\t\t\t\t\t// TODO: Add Register button?\n\t\t\t\t\t\t\t} else if (item.adjusted_price === 'N/A') {\n\t\t\t\t\t\t\t\tresultsHTML += ' (Pricing N/A)';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresultsHTML += ' (Pricing unavailable)';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (item.available === false) {\n\t\t\t\t\t\t\tresultsHTML += '<span class=\"domain-search-unavailable\">Unavailable</span>';\n\t\t\t\t\t\t} else if (item.available === 'error') {\n\t\t\t\t\t\t\t// Use the message returned from the backend for this specific error\n\t\t\t\t\t\t\tresultsHTML += `<span class=\"domain-search-error\">Error: ${escapeHTML(item.message || 'Could not check status.')}</span>`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Fallback for truly unexpected 'available' value\n\t\t\t\t\t\t\tresultsHTML += `<span class=\"domain-search-error\">Unknown status</span>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresultsHTML += '</li>';\n\t\t\t\t\t} else {\n\t\t\t\t\t}\n\t\t\t\t}); // End forEach loop\n\n\t\t\t\tresultsHTML += '</ul>'; // Close the list\n\t\t\t} else if (Array.isArray(data) && data.length === 0) {\n\t\t\t\t// Handle case where backend returned an empty array (e.g., no TLDs checked?)\n\t\t\t\tresultsHTML = '<p>No results were returned for the requested TLDs.</p>';\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Handle case where 'data' wasn't an array after successful parsing\n\t\t\t\tresultsHTML = '<p class=\"domain-search-error\">Received an unexpected response format from the server.</p>';\n\t\t\t}\n\n\t\t\tresultsContainer.innerHTML = resultsHTML; // Update the container with the generated list\n\n\t\t} catch (error) {\n\t\t\t// --- Handle Fetch Errors (Network issues, etc.) or Thrown Errors ---\n\t\t\tconsole.error('Domain Search Error:', error); // Log the error object\n\t\t\t// Display the specific error message property\n\t\t\tresultsContainer.innerHTML = `<p class=\"domain-search-error\">An error occurred: ${escapeHTML(error.message)}. Please try again later.</p>`;\n\t\t} finally {\n\t\t\t// --- Always Re-enable Button/Input ---\n\t\t\t// This block executes regardless of whether try succeeded or failed\n\t\t\tbutton.disabled = false;\n\t\t\tinput.disabled = false;\n\t\t}\n\t}); // End button click listener\n\n\t// Optional: Allow search on pressing Enter in the input field\n\tinput.addEventListener('keypress', (event) => {\n\t\tif (event.key === 'Enter') {\n\t\t\tevent.preventDefault(); // Prevent form submission if it were inside a form\n\t\t\tbutton.click(); // Trigger the button click handler\n\t\t}\n\t});\n\n} // End initializeDomainSearchBlock\n\n// --- Helper function to escape HTML to prevent XSS ---\n// Simple version; consider a more robust library for complex needs\nfunction escapeHTML(str) {\n\tif (typeof str !== 'string') {\n\t\tconsole.warn(\"escapeHTML called with non-string value:\", str);\n\t\treturn ''; // Return empty string for non-strings\n\t}\n\tconst div = document.createElement('div');\n\tdiv.textContent = str;\n\treturn div.innerHTML;\n}\n\n\n// --- Initialize all instances of the block on the page ---\n// Run after the DOM is fully loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n\tconst domainSearchBlocks = document.querySelectorAll('.wp-block-create-block-domain-search');\n\tdomainSearchBlocks.forEach(initializeDomainSearchBlock);\n});\n\n// --- Handle potential dynamic loading (e.g., in Full Site Editor or with other JS frameworks) ---\n// More robust check for blocks added after initial load (optional but good practice)\nif (window.MutationObserver) {\n\tconst observer = new MutationObserver(mutationsList => {\n\t\tfor (const mutation of mutationsList) {\n\t\t\tif (mutation.type === 'childList') {\n\t\t\t\tmutation.addedNodes.forEach(node => {\n\t\t\t\t\t// Check if the added node is the block itself\n\t\t\t\t\tif (node.nodeType === 1 && node.matches('.wp-block-create-block-domain-search')) {\n\t\t\t\t\t\t// Check if it's already initialized (e.g., by DOMContentLoaded)\n\t\t\t\t\t\tif (!node.dataset.domainSearchInitialized) {\n\t\t\t\t\t\t\tinitializeDomainSearchBlock(node);\n\t\t\t\t\t\t\tnode.dataset.domainSearchInitialized = 'true'; // Mark as initialized\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Check if the added node contains the block(s)\n\t\t\t\t\telse if (node.nodeType === 1 && node.querySelector) {\n\t\t\t\t\t\tconst blocksInside = node.querySelectorAll('.wp-block-create-block-domain-search:not([data-domain-search-initialized])');\n\t\t\t\t\t\tblocksInside.forEach(block => {\n\t\t\t\t\t\t\tinitializeDomainSearchBlock(block);\n\t\t\t\t\t\t\tblock.dataset.domainSearchInitialized = 'true'; // Mark as initialized\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tobserver.observe(document.body, { childList: true, subtree: true });\n}\n"],"names":["initializeDomainSearchBlock","blockElement","input","querySelector","button","resultsContainer","console","error","sldRegex","invalidHyphenRegex","validateDomainInput","domainValue","value","trim","toLowerCase","isValid","errorMessage","classList","remove","feedbackElement","document","createElement","className","wrapper","closest","parentNode","insertBefore","nextSibling","textContent","parts","split","potentialSld","length","slice","join","potentialTld","pop","test","add","addEventListener","domain","contains","focus","innerHTML","disabled","formData","FormData","append","response","fetch","domainSearchData","apiUrl","method","headers","nonce","body","responseText","text","ok","status","statusText","errorData","JSON","parse","message","e","warn","startsWith","Error","data","resultsHTML","Array","isArray","forEach","item","escapeHTML","available","adjusted_price","event","key","preventDefault","click","str","div","domainSearchBlocks","querySelectorAll","window","MutationObserver","observer","mutationsList","mutation","type","addedNodes","node","nodeType","matches","dataset","domainSearchInitialized","blocksInside","block","observe","childList","subtree"],"sourceRoot":""}