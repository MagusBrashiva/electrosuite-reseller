{"version":3,"file":"domain-search/view.js","mappings":"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","sources":["webpack://domain-search/./src/domain-search/view.js"],"sourcesContent":["/**\n * Front-end JavaScript for the Domain Search Block.\n *\n * Handles user input, makes API requests via the WordPress REST API,\n * and displays results.\n */\n\n// Function to run for each domain search block instance on the page\nfunction initializeDomainSearchBlock(blockElement) {\n\t// Find the necessary elements within this specific block instance\n\tconst input = blockElement.querySelector('.domain-search-input');\n\tconst button = blockElement.querySelector('.domain-search-button');\n\tconst resultsContainer = blockElement.querySelector('.domain-search-results');\n\n\t// Exit if essential elements aren't found (safety check)\n\tif (!input || !button || !resultsContainer) {\n\t\tconsole.error('Domain Search Block: Missing required elements inside:', blockElement);\n\t\treturn;\n\t}\n\n\t// --- Event Listener for the Search Button ---\n\tbutton.addEventListener('click', async () => {\n\t\tconst domain = input.value.trim().toLowerCase();\n\n\t\t// --- Basic Validation ---\n\t\tif (!domain) {\n\t\t\tresultsContainer.innerHTML = '<p class=\"domain-search-error\">Please enter a domain name.</p>';\n\t\t\tinput.focus(); // Focus back on the input\n\t\t\treturn;\n\t\t}\n\t\t// Very basic domain format check (doesn't validate TLD)\n\t\tif (domain.indexOf('.') === -1 || domain.startsWith('.') || domain.endsWith('.')) {\n\t\t\tresultsContainer.innerHTML = `<p class=\"domain-search-error\">Please enter a valid domain format (e.g., example.com).</p>`;\n\t\t\tinput.focus();\n\t\t\treturn;\n\t\t}\n\n\t\t// --- Show Loading State ---\n\t\tresultsContainer.innerHTML = '<p class=\"domain-search-loading\">Checking availability...</p>';\n\t\tbutton.disabled = true; // Prevent multiple clicks\n\t\tinput.disabled = true; // Optional: disable input during search\n\n\t\t// --- Prepare API Request ---\n\t\tconst formData = new FormData();\n\t\tformData.append('action', 'domain_search_check'); // Not strictly needed for REST, but good practice if using admin-ajax fallback later\n\t\tformData.append('domain', domain);\n\t\tformData.append('_wpnonce', domainSearchData.nonce); // Use the nonce passed from PHP\n\n\t\ttry {\n\t\t\t// --- Make the Fetch Request ---\n\t\t\tconst response = await fetch(domainSearchData.apiUrl, { // Use the API URL from PHP\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t// Content-Type is not needed for FormData with fetch; browser sets it with boundary\n\t\t\t\t\t// 'Content-Type': 'application/x-www-form-urlencoded', // Use if sending data differently\n\t\t\t\t\t'X-WP-Nonce': domainSearchData.nonce // Standard header for REST API nonce\n\t\t\t\t},\n\t\t\t\tbody: formData // Send domain and nonce\n\t\t\t});\n\n\t\t\t// --- Handle Non-OK HTTP Responses (e.g., 403 Forbidden, 404 Not Found, 500 Server Error) ---\n\t\t\tif (!response.ok) {\n\t\t\t\tlet errorMessage = `Error: ${response.status} ${response.statusText}`;\n\t\t\t\ttry {\n\t\t\t\t\t// Try to get more specific error message from the API response body\n\t\t\t\t\tconst errorData = await response.json();\n\t\t\t\t\tif (errorData.message) {\n\t\t\t\t\t\terrorMessage = errorData.message;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// Ignore if response body is not JSON or empty\n\t\t\t\t}\n\t\t\t\tthrow new Error(errorMessage); // Trigger the catch block\n\t\t\t}\n\n\t\t\t// --- Process Successful Response ---\n\t\t\tconst data = await response.json(); // Parse the JSON body\n\n\t\t\t// --- Display Results ---\n\t\t\t// This part depends heavily on the structure of the 'data' object\n\t\t\t// returned by your handle_electrosuite_domain_search_request PHP function\n\t\t\tlet resultsHTML = '';\n\t\t\tif (data.available === true) {\n\t\t\t\tresultsHTML = `<p class=\"domain-search-success\">Congratulations! <strong>${escapeHTML(data.domain)}</strong> is available!</p>`;\n\t\t\t\t// TODO: Add purchase button/link if needed\n\t\t\t} else if (data.available === false) {\n\t\t\t\tresultsHTML = `<p class=\"domain-search-unavailable\">Sorry, <strong>${escapeHTML(data.domain)}</strong> is not available.</p>`;\n\t\t\t\t// TODO: Display suggestions if available in 'data.suggestions'\n\t\t\t\tif (data.suggestions && data.suggestions.length > 0) {\n\t\t\t\t\tresultsHTML += '<h4>Suggestions:</h4><ul>';\n\t\t\t\t\tdata.suggestions.forEach(suggestion => {\n\t\t\t\t\t\tresultsHTML += `<li>${escapeHTML(suggestion)}</li>`; // Make sure suggestions are safe too\n\t\t\t\t\t});\n\t\t\t\t\tresultsHTML += '</ul>';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Handle cases where availability is unknown or the API response was unexpected\n\t\t\t\tresultsHTML = `<p class=\"domain-search-error\">Could not determine availability for <strong>${escapeHTML(data.domain)}</strong>. Please try again.</p>`;\n\t\t\t\tconsole.warn('Unexpected API response structure:', data);\n\t\t\t}\n\n\t\t\tresultsContainer.innerHTML = resultsHTML;\n\n\t\t} catch (error) {\n\t\t\t// --- Handle Fetch Errors (Network issues, etc.) or Thrown Errors ---\n\t\t\tconsole.error('Domain Search Error:', error);\n\t\t\tresultsContainer.innerHTML = `<p class=\"domain-search-error\">An error occurred: ${escapeHTML(error.message)}. Please try again later.</p>`;\n\t\t} finally {\n\t\t\t// --- Always Re-enable Button/Input ---\n\t\t\tbutton.disabled = false;\n\t\t\tinput.disabled = false;\n\t\t}\n\t}); // End button click listener\n\n\t// Optional: Allow search on pressing Enter in the input field\n\tinput.addEventListener('keypress', (event) => {\n\t\tif (event.key === 'Enter') {\n\t\t\tevent.preventDefault(); // Prevent form submission if it were inside a form\n\t\t\tbutton.click(); // Trigger the button click handler\n\t\t}\n\t});\n\n} // End initializeDomainSearchBlock\n\n// --- Helper function to escape HTML to prevent XSS ---\n// Simple version; consider a more robust library for complex needs\nfunction escapeHTML(str) {\n\tconst div = document.createElement('div');\n\tdiv.textContent = str;\n\treturn div.innerHTML;\n}\n\n\n// --- Initialize all instances of the block on the page ---\n// Run after the DOM is fully loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n\tconst domainSearchBlocks = document.querySelectorAll('.wp-block-create-block-domain-search');\n\tdomainSearchBlocks.forEach(initializeDomainSearchBlock);\n});\n\n// --- Handle potential dynamic loading (e.g., in Full Site Editor or with other JS frameworks) ---\n// More robust check for blocks added after initial load (optional but good practice)\nif (window.MutationObserver) {\n\tconst observer = new MutationObserver(mutationsList => {\n\t\tfor (const mutation of mutationsList) {\n\t\t\tif (mutation.type === 'childList') {\n\t\t\t\tmutation.addedNodes.forEach(node => {\n\t\t\t\t\t// Check if the added node is the block itself\n\t\t\t\t\tif (node.nodeType === 1 && node.matches('.wp-block-create-block-domain-search')) {\n\t\t\t\t\t\tinitializeDomainSearchBlock(node);\n\t\t\t\t\t}\n\t\t\t\t\t// Check if the added node contains the block(s)\n\t\t\t\t\telse if (node.nodeType === 1 && node.querySelector) {\n\t\t\t\t\t\tconst blocksInside = node.querySelectorAll('.wp-block-create-block-domain-search');\n\t\t\t\t\t\tblocksInside.forEach(initializeDomainSearchBlock);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t});\n\n\tobserver.observe(document.body, { childList: true, subtree: true });\n}\n"],"names":["initializeDomainSearchBlock","blockElement","input","querySelector","button","resultsContainer","console","error","addEventListener","domain","value","trim","toLowerCase","innerHTML","focus","indexOf","startsWith","endsWith","disabled","formData","FormData","append","domainSearchData","nonce","response","fetch","apiUrl","method","headers","body","ok","errorMessage","status","statusText","errorData","json","message","e","Error","data","resultsHTML","available","escapeHTML","suggestions","length","forEach","suggestion","warn","event","key","preventDefault","click","str","div","document","createElement","textContent","domainSearchBlocks","querySelectorAll","window","MutationObserver","observer","mutationsList","mutation","type","addedNodes","node","nodeType","matches","blocksInside","observe","childList","subtree"],"sourceRoot":""}